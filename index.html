<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Date Decider — Tomorrow</title>

  <style>
    :root{
      --bg1:#f6f7ff;
      --bg2:#fff6fb;

      --text: rgba(20,22,30,.92);
      --muted: rgba(20,22,30,.68);

      --line: rgba(20,22,30,.12);
      --shadow: 0 18px 50px rgba(20,22,30,.12);

      --cardSolid: rgba(255,255,255,.92);
      --cardSoft: rgba(255,255,255,.78);

      --r: 22px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      overflow-x:hidden;
      background:
        radial-gradient(1200px 700px at 20% 15%, rgba(120,180,255,.30), transparent 60%),
        radial-gradient(900px 600px at 80% 20%, rgba(255,150,210,.28), transparent 55%),
        radial-gradient(900px 700px at 40% 90%, rgba(140,255,210,.22), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    /* Animated blobs (visible effect) */
    .blobs{
      position: fixed;
      inset: -20%;
      pointer-events: none;
      z-index: 0;
      filter: blur(40px);
      opacity: .9;
      animation: blobsFloat 16s ease-in-out infinite alternate;
    }
    .blob{
      position:absolute;
      width: 520px;
      height: 520px;
      border-radius: 999px;
      mix-blend-mode: multiply;
      opacity: .55;
      transform: translate3d(0,0,0);
    }
    .b1{ left: 8%; top: 10%; background: rgba(120,180,255,.55); animation: b1 18s ease-in-out infinite alternate; }
    .b2{ right: 8%; top: 18%; background: rgba(255,150,210,.55); animation: b2 20s ease-in-out infinite alternate; }
    .b3{ left: 28%; bottom: 6%; background: rgba(140,255,210,.48); animation: b3 22s ease-in-out infinite alternate; }

    @keyframes blobsFloat{
      from{ transform: translate3d(0,0,0) scale(1); }
      to{ transform: translate3d(2%, -1.5%, 0) scale(1.03); }
    }
    @keyframes b1{ from{ transform: translate(0,0) scale(1);} to{ transform: translate(60px, 40px) scale(1.08);} }
    @keyframes b2{ from{ transform: translate(0,0) scale(1);} to{ transform: translate(-70px, 55px) scale(1.06);} }
    @keyframes b3{ from{ transform: translate(0,0) scale(1);} to{ transform: translate(40px, -60px) scale(1.10);} }

    /* Subtle grain */
    .grain{
      pointer-events:none;
      position:fixed; inset:0;
      z-index: 1;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="180" height="180"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".9" numOctaves="3" stitchTiles="stitch"/></filter><rect width="180" height="180" filter="url(%23n)" opacity=".35"/></svg>');
      mix-blend-mode: overlay;
      opacity:.028;
      animation: grainFloat 10s ease-in-out infinite alternate;
    }
    @keyframes grainFloat{
      from{transform:translate3d(0,0,0)}
      to{transform:translate3d(10px,-6px,0)}
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: calc(18px + env(safe-area-inset-top)) 16px calc(74px + env(safe-area-inset-bottom));
      position:relative;
      z-index: 2;
    }

    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 6px 0 14px;
      animation: enterDown .55s ease-out both;
    }
    @keyframes enterDown{
      from{opacity:0; transform: translateY(-10px)}
      to{opacity:1; transform: translateY(0)}
    }

    .brand{ display:flex; align-items:center; gap:12px; user-select:none; }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, rgba(255,255,255,.76), rgba(255,255,255,.32));
      border:1px solid var(--line);
      box-shadow: 0 14px 40px rgba(20,22,30,.12);
      display:grid; place-items:center;
      position:relative; overflow:hidden;
      transform: translateZ(0);
    }
    .logo:before{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(20,22,30,0), rgba(20,22,30,.12), rgba(20,22,30,0));
      animation: spin 3.2s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg) } }
    .logo span{ position:relative; font-weight:900; opacity:.95; }

    .title{ display:flex; flex-direction:column; line-height:1.12; }
    .title strong{ font-size:14px; letter-spacing:.2px; }
    .title small{ font-size:12px; color:var(--muted); }

    .chip{
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.70);
      color:var(--muted);
      font-size:12px;
      display:flex; align-items:center; gap:8px;
      white-space:nowrap;
      box-shadow: 0 10px 26px rgba(20,22,30,.08);
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: rgba(120,255,190,.9);
      box-shadow: 0 0 22px rgba(120,255,190,.35);
    }

    .card{
      background: var(--cardSolid);
      border: 1px solid rgba(20,22,30,.14);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(8px);
      transform: translateZ(0);
    }

    .hero{
      display:grid;
      grid-template-columns: 1.3fr .9fr;
      gap:14px;
      align-items:stretch;
      margin-top: 6px;
    }

    .hero > .card{
      animation: enterUp .65s cubic-bezier(.2,.9,.2,1) both;
    }
    .side{ animation: enterUp .75s cubic-bezier(.2,.9,.2,1) both; }
    @keyframes enterUp{
      from{opacity:0; transform: translateY(14px)}
      to{opacity:1; transform: translateY(0)}
    }

    .h1{
      font-size: clamp(26px, 4.2vw, 36px);
      line-height: 1.05;
      margin: 6px 0 10px;
      letter-spacing:-.6px;
    }
    .sub{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
      margin: 0 0 14px;
      max-width: 62ch;
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* Buttons with ripple + glow */
    button{
      cursor:pointer;
      border:1px solid rgba(20,22,30,.14);
      background: rgba(255,255,255,.76);
      color: var(--text);
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 850;
      letter-spacing:.2px;
      transition: transform .15s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
      user-select:none;
      position:relative;
      overflow:hidden;
    }
    button:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.92);
      box-shadow: 0 14px 34px rgba(20,22,30,.10);
    }
    button:active{ transform: translateY(1px) scale(.99); }

    button::after{
      content:"";
      position:absolute;
      left: var(--rx, 50%);
      top: var(--ry, 50%);
      width: 10px; height: 10px;
      transform: translate(-50%,-50%) scale(0);
      border-radius: 999px;
      background: rgba(20,22,30,.10);
      opacity: 0;
      transition: transform .45s ease, opacity .55s ease;
      pointer-events:none;
    }
    button.ripple::after{
      transform: translate(-50%,-50%) scale(18);
      opacity: 1;
    }

    .primary{
      background: linear-gradient(135deg, rgba(120,180,255,.30), rgba(255,150,210,.24));
      border-color: rgba(20,22,30,.16);
    }

    .divider{ height:1px; background: var(--line); margin: 14px 0; }

    .side{ display:flex; flex-direction:column; gap:12px; height:100%; }
    .mini{
      background: var(--cardSoft);
      border:1px solid rgba(20,22,30,.14);
      border-radius: var(--r);
      padding:16px;
      display:flex; flex-direction:column; gap:10px;
      min-height: 150px;
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .mini:hover{ transform: translateY(-2px); box-shadow: 0 18px 40px rgba(20,22,30,.10); }
    .mini h3{
      margin:0;
      font-size: 12px;
      letter-spacing:.28px;
      color: rgba(20,22,30,.78);
      text-transform: uppercase;
    }
    .mini p{
      margin:0;
      color: rgba(20,22,30,.72);
      font-size: 13px;
      font-weight: 550;
      line-height: 1.6;
    }

    /* scenes */
    .scene{
      margin-top: 14px;
      display:none;
      opacity:0;
      transform: translateY(14px);
      transition: opacity .35s ease, transform .35s ease;
    }
    .scene.active{ display:block; }
    .scene.show{ opacity:1; transform: translateY(0); }

    /* result grid */
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(20,22,30,.12);
      background: rgba(255,255,255,.70);
      color: var(--muted);
      font-size:12px;
    }

    .resultBox{
      position:relative;
      overflow:hidden;
      padding: 16px;
      border-radius: var(--r);
      border:1px solid rgba(20,22,30,.14);
      background: rgba(255,255,255,.90);
      min-height: 160px;
      transition: transform .22s ease, box-shadow .22s ease;
    }
    .resultBox:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 44px rgba(20,22,30,.10);
    }

    .resultTitle{
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start;
      margin-bottom: 8px;
    }
    .choice{
      font-size: 22px;
      font-weight: 950;
      letter-spacing:-.2px;
      margin: 2px 0 4px;
    }
    .tag{
      font-size: 12px;
      color: rgba(20,22,30,.78);
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(20,22,30,.12);
      padding: 7px 10px;
      border-radius: 999px;
      white-space:nowrap;
    }

    .timeline{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 12px;
    }
    .slot{
      display:flex; gap:12px;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(20,22,30,.14);
      background: rgba(255,255,255,.94);
    }
    .time{
      min-width: 92px;
      font-weight: 950;
      color: rgba(20,22,30,.86);
      font-size: 12px;
      letter-spacing:.2px;
    }
    .act{
      color: rgba(20,22,30,.72);
      font-size: 13px;
      line-height: 1.55;
    }

    footer{
      margin-top: 18px;
      color: rgba(20,22,30,.55);
      font-size: 12px;
      text-align:center;
    }

    /* confetti canvas */
    canvas#confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 30;
    }

    /* Decision overlay (very visible moment) */
    #decisionOverlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 80;
      background: radial-gradient(900px 600px at 50% 40%, rgba(255,255,255,.90), rgba(255,255,255,.62));
      backdrop-filter: blur(12px);
    }
    #decisionOverlay.show{ display:flex; animation: fadeIn .18s ease-out; }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

    .decisionCard{
      width:min(720px, 94vw);
      border-radius: 28px;
      border: 1px solid rgba(20,22,30,.14);
      background: rgba(255,255,255,.96);
      box-shadow: 0 30px 90px rgba(20,22,30,.22);
      padding: 20px 18px;
      text-align:center;
      transform: translateY(14px) scale(.98);
      animation: pop .28s cubic-bezier(.2,.9,.2,1) forwards;
      position: relative;
      overflow:hidden;
    }
    .decisionCard::before{
      content:"";
      position:absolute;
      inset:-60%;
      background: conic-gradient(from 200deg,
        rgba(120,180,255,.0),
        rgba(120,180,255,.35),
        rgba(255,150,210,.35),
        rgba(140,255,210,.28),
        rgba(120,180,255,.0));
      animation: glowSpin 4.2s linear infinite;
      opacity:.55;
    }
    .decisionCard > *{ position:relative; }
    @keyframes glowSpin{ to{ transform: rotate(360deg); } }

    @keyframes pop{ to{ transform: translateY(0) scale(1) } }

    .decisionSmall{
      font-size: 12px;
      letter-spacing: .28px;
      text-transform: uppercase;
      color: rgba(20,22,30,.62);
      margin-bottom: 8px;
    }
    .decisionBig{
      font-size: clamp(30px, 7vw, 44px);
      font-weight: 1000;
      letter-spacing: -0.8px;
      color: rgba(20,22,30,.92);
      margin: 6px 0 8px;
      text-shadow: 0 10px 30px rgba(20,22,30,.10);
    }
    .decisionDesc{
      font-size: 14px;
      line-height: 1.6;
      color: rgba(20,22,30,.74);
      margin: 0 0 14px;
      max-width: 62ch;
      margin-left:auto;
      margin-right:auto;
    }
    .decisionBtns{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }

    /* focus pulse highlight after decision */
    .pulse{
      animation: pulse 1.15s ease-out 1;
    }
    @keyframes pulse{
      0%{ box-shadow: 0 0 0 0 rgba(120,180,255,.0); transform: translateY(0); }
      30%{ box-shadow: 0 0 0 10px rgba(120,180,255,.22); transform: translateY(-2px); }
      100%{ box-shadow: 0 0 0 0 rgba(120,180,255,.0); transform: translateY(0); }
    }

    /* Mobile */
    @media (max-width: 860px){
      .hero{ grid-template-columns:1fr; }
      .grid2{ grid-template-columns:1fr; }
      .chip{ display:none; }
    }
    @media (max-width: 520px){
      .wrap{ padding-left: 14px; padding-right: 14px; }
      .card{ padding: 16px; }
      .btnRow button{ flex: 1 1 100%; }
      .slot{ flex-direction: column; gap:6px; }
      .time{ min-width: 0; }
      .resultTitle{ flex-direction: column; align-items:flex-start; }
      .tag{ align-self:flex-start; }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; }
      .blobs{ display:none; }
    }
  </style>
</head>

<body>
  <div class="blobs" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>
  <div class="grain" aria-hidden="true"></div>
  <canvas id="confetti"></canvas>

  <!-- Decision overlay -->
  <div id="decisionOverlay" aria-hidden="true">
    <div class="decisionCard">
      <div class="decisionSmall">Tomorrow’s vibe is…</div>
      <div class="decisionBig" id="decisionBigText">—</div>
      <div class="decisionDesc" id="decisionDescText">—</div>
      <div class="decisionBtns">
        <button class="primary" id="decisionContinue">Continue</button>
        <button id="decisionReroll">Reroll</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"><span>♥</span></div>
        <div class="title">
          <strong>Date Decider</strong>
          <small>Modern little ritual for two</small>
        </div>
      </div>
      <div class="chip"><span class="dot"></span><span id="todayText">Ready for tomorrow</span></div>
    </header>

    <section class="hero">
      <div class="card">
        <div class="pill">✨ A tiny story-based picker • 2 options • Saturday-ready</div>
        <h1 class="h1">Let tomorrow decide itself.</h1>
        <p class="sub">
          We’ll do this properly: a soft opening, a clean transition, and a satisfying ending.
          One click to pick the vibe — then we follow a full-day plan that still lets us sleep in until <b>9–10am</b>.
        </p>

        <div class="btnRow">
          <button class="primary" id="startBtn">Start the ritual</button>
          <button id="skipBtn">Skip to the picker</button>
          <button id="resetBtn" title="Clear saved result">Reset</button>
        </div>

        <div class="divider"></div>

        <p class="sub" style="margin:0">
          <span style="opacity:.9;font-weight:900">MVP options for tomorrow:</span>
          <span style="color:var(--muted)">Out date</span> vs <span style="color:var(--muted)">Stay-home date</span>.
          Random, fair, and a bit cinematic.
        </p>
      </div>

      <div class="side">
        <div class="mini">
          <h3>Automation</h3>
          <p>• Remembers your last choice (so you can reopen and smile).</p>
          <p>• Reroll button when you want destiny to “try again”.</p>
          <p>• Gentle confetti when a choice lands.</p>
        </div>
        <div class="mini">
          <h3>Saturday rule</h3>
          <p><b>Sleep in until 9–10am</b> is non-negotiable. The plan starts slow, then ramps up.</p>
          <p>It’s balanced: cozy + romance + a little momentum.</p>
        </div>
      </div>
    </section>

    <!-- Scene 1 -->
    <section class="scene active show" id="sceneOpening">
      <div class="card">
        <h2 style="margin:0 0 8px; font-size:18px; letter-spacing:-.2px;">Opening</h2>
        <p class="sub" style="margin-bottom:0;max-width: 75ch;">
          Tonight we’re not overthinking. We’re doing a small, elegant experiment:
          two paths, one coin-flip moment, and a whole day shaped around it.
          Tomorrow morning, we wake up gently — and we let the vibe pick us.
        </p>
      </div>
    </section>

    <!-- Scene 2 -->
    <section class="scene" id="sceneTransition">
      <div class="card">
        <h2 style="margin:0 0 8px; font-size:18px; letter-spacing:-.2px;">Transition</h2>
        <p class="sub" style="margin:0;max-width: 75ch;">
          Take a breath. Imagine: sunlight, slow stretching, no alarms yelling.
          When you’re ready, press <b>Decide</b> — and we’ll commit.
        </p>
        <div class="btnRow" style="margin-top:14px">
          <button class="primary" id="decideBtn">Decide</button>
          <button id="backBtn">Back</button>
        </div>
      </div>
    </section>

    <!-- Scene 3 -->
    <section class="scene" id="sceneResult">
      <div class="card">
        <div class="grid2">
          <div class="resultBox" id="resultLeft">
            <div class="resultTitle">
              <div>
                <div style="font-size:12px;color:var(--muted);letter-spacing:.25px;text-transform:uppercase;">Tomorrow’s vibe</div>
                <div class="choice" id="choiceText">—</div>
                <div style="color:var(--muted);font-size:13px;line-height:1.6" id="choiceDesc">
                  Click decide to get a plan.
                </div>
              </div>
              <div class="tag" id="choiceTag">MVP</div>
            </div>

            <div class="btnRow" style="margin-top:10px">
              <button class="primary" id="rerollBtn">Reroll</button>
              <button id="lockBtn" title="Lock choice and go to ending">Lock it</button>
            </div>
          </div>

          <div class="resultBox" id="resultRight">
            <div style="font-size:12px;color:var(--muted);letter-spacing:.25px;text-transform:uppercase;">Full Saturday plan</div>
            <div style="margin-top:8px; color: rgba(20,22,30,.84); font-weight:950; letter-spacing:-.15px;">
              Sleep-in edition (start slow, end sweet)
            </div>
            <div class="timeline" id="timeline"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Scene 4 -->
    <section class="scene" id="sceneEnding">
      <div class="card">
        <h2 style="margin:0 0 8px; font-size:18px; letter-spacing:-.2px;">Ending</h2>
        <p class="sub" style="max-width: 80ch;">
          Tomorrow isn’t about being “productive”. It’s about being <b>present</b>.
          We picked a vibe, we followed a plan, and we left room for spontaneous little moments.
        </p>
        <div class="pill" id="endingPill">Saved. See you tomorrow.</div>
        <div class="btnRow" style="margin-top:14px">
          <button class="primary" id="againBtn">Do it again</button>
          <button id="copyBtn">Copy plan text</button>
        </div>
      </div>
    </section>

    <footer>Built with love + a tiny bit of randomness.</footer>
  </div>

  <script>
    // ===== Helpers =====
    const $ = (id) => document.getElementById(id);
    const scenes = ["sceneOpening","sceneTransition","sceneResult","sceneEnding"];

    function showScene(target){
      scenes.forEach(s => {
        const el = $(s);
        if(!el) return;
        el.classList.remove("active","show");
        if(s === target){
          el.classList.add("active");
          requestAnimationFrame(()=> el.classList.add("show"));
        }
      });
      window.scrollTo({top: 0, behavior: "smooth"});
    }

    function formatToday(){
      const d = new Date();
      const opts = { weekday:"long", year:"numeric", month:"short", day:"numeric" };
      return d.toLocaleDateString(undefined, opts);
    }
    $("todayText").textContent = "Today is " + formatToday();

    // Button ripple (visible interaction)
    function ripple(btn, e){
      const rect = btn.getBoundingClientRect();
      const x = (e?.clientX ?? (rect.left + rect.width/2)) - rect.left;
      const y = (e?.clientY ?? (rect.top + rect.height/2)) - rect.top;
      btn.style.setProperty("--rx", x + "px");
      btn.style.setProperty("--ry", y + "px");
      btn.classList.remove("ripple");
      // force reflow
      void btn.offsetWidth;
      btn.classList.add("ripple");
      setTimeout(()=> btn.classList.remove("ripple"), 520);
    }

    document.addEventListener("click", (e)=>{
      const btn = e.target.closest("button");
      if(btn) ripple(btn, e);
    });

    // ===== Options =====
    const OPTIONS = [
      {
        key: "out",
        name: "Out date",
        tag: "Go outside",
        desc: "We get dressed nicely, step out, and let the city be our background music.",
        timeline: [
          ["9:30–10:15", "Sleep in. Gentle wake-up, no rushing. Water + cuddles."],
          ["10:15–11:15", "Brunch mission: pick one cozy place (or order something you both love)."],
          ["11:15–12:30", "Slow walk: bookstore / café / park. Photos are optional, vibes are mandatory."],
          ["12:30–14:00", "A small ‘main event’: museum, cinema, or a new neighborhood you’ve never explored."],
          ["14:00–16:00", "Recharge: ice cream + sit somewhere pretty. Talk about nothing, then everything."],
          ["16:00–18:30", "Nap / downtime at home. Shower, music, and reset."],
          ["19:00–21:00", "Dinner date: one signature dish each (or one shared set). No phones, just us."],
          ["21:00–late", "Night walk or dessert stop. End with a ‘one good thing’ recap in bed."]
        ]
      },
      {
        key: "home",
        name: "Stay-home date",
        tag: "Cozy mode",
        desc: "We turn the house into a tiny universe: comfort, laughs, and slow affection.",
        timeline: [
          ["9:30–10:30", "Sleep in. Wake up like cats. Curtains half-open, soft light."],
          ["10:30–11:30", "Brunch at home: eggs/toast/noodles/anything. One cooks, one DJs."],
          ["11:30–13:00", "Cozy block: board game / co-op game / puzzle / ‘read next to each other’ time."],
          ["13:00–14:30", "Mini movie: one episode or one film (shortlist 3, random pick 1)."],
          ["14:30–16:30", "Nap + snack + slow kisses. The house stays quiet."],
          ["16:30–18:30", "Home spa: shower, skincare, haircare — take your time."],
          ["19:00–21:00", "Cook together: simple but special. Plate it nicely like a restaurant."],
          ["21:00–late", "Dessert + journaling prompt: ‘what did I love today?’ Then fall asleep close."]
        ]
      }
    ];

    function randomPick(){
      return OPTIONS[Math.floor(Math.random() * OPTIONS.length)];
    }

    function setPlan(opt){
      $("choiceText").textContent = opt.name;
      $("choiceTag").textContent = opt.tag;
      $("choiceDesc").textContent = opt.desc;

      const tl = $("timeline");
      tl.innerHTML = "";
      opt.timeline.forEach(([t, a])=>{
        const row = document.createElement("div");
        row.className = "slot";
        row.innerHTML = `<div class="time">${t}</div><div class="act">${a}</div>`;
        tl.appendChild(row);
      });

      $("endingPill").textContent = `Locked in: ${opt.name}. Tomorrow, we follow the vibe.`;
    }

    function saveChoice(opt){
      localStorage.setItem("dateDecider:lastChoice", JSON.stringify({
        key: opt.key,
        savedAt: new Date().toISOString()
      }));
    }

    function loadChoice(){
      try{
        const raw = localStorage.getItem("dateDecider:lastChoice");
        if(!raw) return null;
        const { key } = JSON.parse(raw);
        return OPTIONS.find(o => o.key === key) || null;
      }catch(e){
        return null;
      }
    }

    // ===== Confetti (more visible on desktop) =====
    const canvas = $("confetti");
    const ctx = canvas.getContext("2d");
    let confetti = [];
    let confettiOn = false;

    function resize(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    const confettiPalette = [
      "rgba(120,180,255,.95)",
      "rgba(255,150,210,.95)",
      "rgba(140,255,210,.92)",
      "rgba(255,210,120,.95)"
    ];

    function launchConfetti(){
      confetti = [];
      const count = Math.min(220, Math.floor(window.innerWidth * 0.25));
      for(let i=0;i<count;i++){
        confetti.push({
          x: Math.random()*canvas.width,
          y: -20 - Math.random()*canvas.height*0.15,
          r: 2 + Math.random()*5,
          vx: -1.5 + Math.random()*3.0,
          vy: 2.6 + Math.random()*5.2,
          a: Math.random()*Math.PI*2,
          va: -0.25 + Math.random()*0.5,
          life: 90 + Math.random()*70,
          c: confettiPalette[(Math.random()*confettiPalette.length)|0]
        });
      }
      confettiOn = true;
      requestAnimationFrame(tickConfetti);
      setTimeout(()=> confettiOn = false, 1700);
    }

    function tickConfetti(){
      if(!confettiOn && confetti.length===0) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      confetti = confetti.filter(p => p.life-- > 0);
      for(const p of confetti){
        p.x += p.vx;
        p.y += p.vy;
        p.a += p.va;
        p.vy += 0.035;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.a);
        ctx.globalAlpha = Math.max(0, Math.min(1, p.life/160));
        ctx.fillStyle = p.c;
        ctx.fillRect(-p.r, -p.r/2, p.r*2.4, p.r);
        ctx.restore();
      }
      if(confettiOn || confetti.length>0) requestAnimationFrame(tickConfetti);
    }

    // ===== Decision overlay =====
    function openDecisionOverlay(opt){
      $("decisionBigText").textContent = opt.name;
      $("decisionDescText").textContent = opt.desc;
      const overlay = $("decisionOverlay");
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
      if (navigator.vibrate) navigator.vibrate([18, 25, 18]);
    }

    function closeDecisionOverlay(){
      const overlay = $("decisionOverlay");
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
    }

    // ===== Wiring =====
    let current = loadChoice();

    if(current){
      setPlan(current);
    }else{
      setPlan(OPTIONS[0]);
      $("choiceText").textContent = "Undecided";
      $("choiceDesc").textContent = "Press Decide to let randomness pick the vibe.";
      $("choiceTag").textContent = "MVP";
      $("timeline").innerHTML = "";
    }

    $("startBtn").addEventListener("click", ()=> showScene("sceneTransition"));
    $("skipBtn").addEventListener("click", ()=> showScene("sceneResult"));
    $("backBtn").addEventListener("click", ()=> showScene("sceneOpening"));

    function doDecide(){
      current = randomPick();
      setPlan(current);
      saveChoice(current);
      launchConfetti();
      openDecisionOverlay(current);
    }

    $("decideBtn").addEventListener("click", doDecide);

    $("decisionContinue").addEventListener("click", ()=>{
      closeDecisionOverlay();
      showScene("sceneResult");
      // highlight result panel
      const left = $("resultLeft");
      left.classList.remove("pulse");
      void left.offsetWidth;
      left.classList.add("pulse");
      setTimeout(()=> left.classList.remove("pulse"), 1200);
    });

    $("decisionReroll").addEventListener("click", ()=>{
      current = randomPick();
      setPlan(current);
      saveChoice(current);
      launchConfetti();
      openDecisionOverlay(current);
    });

    $("rerollBtn").addEventListener("click", ()=>{
      current = randomPick();
      setPlan(current);
      saveChoice(current);
      launchConfetti();
      openDecisionOverlay(current);
    });

    $("lockBtn").addEventListener("click", ()=>{
      if(!current) current = randomPick();
      saveChoice(current);
      showScene("sceneEnding");
    });

    $("againBtn").addEventListener("click", ()=> showScene("sceneTransition"));

    $("resetBtn").addEventListener("click", ()=>{
      localStorage.removeItem("dateDecider:lastChoice");
      current = null;
      $("choiceText").textContent = "Undecided";
      $("choiceDesc").textContent = "Press Decide to let randomness pick the vibe.";
      $("choiceTag").textContent = "MVP";
      $("timeline").innerHTML = "";
      showScene("sceneOpening");
    });

    $("copyBtn").addEventListener("click", async ()=>{
      const choice = $("choiceText").textContent;
      const rows = [...document.querySelectorAll("#timeline .slot")].map(el=>{
        const t = el.querySelector(".time")?.textContent || "";
        const a = el.querySelector(".act")?.textContent || "";
        return `${t} — ${a}`;
      });
      const text = `Tomorrow's vibe: ${choice}\n\nSaturday plan:\n` + rows.join("\n");
      try{
        await navigator.clipboard.writeText(text);
        $("endingPill").textContent = "Copied. Now we just show up and enjoy.";
      }catch(e){
        $("endingPill").textContent = "Copy blocked by browser. Select text manually if needed.";
      }
    });
  </script>
</body>
</html>
